spring.application.name=repoai
spring.config.import=optional:dotenv:.env

spring.datasource.url=${DB_URL:jdbc:mysql://127.0.0.1:3306/repoai?useSSL=false&allowPublicKeyRetrieval=true}
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:root}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.hibernate.ddl-auto=update

spring.jpa.show-sql=true

server.port=${PORT:8080}

# GitHub OAuth Configuration
spring.security.oauth2.client.registration.github.client-id=${GITHUB_CLIENT_ID}
spring.security.oauth2.client.registration.github.client-secret=${GITHUB_CLIENT_SECRET}
spring.security.oauth2.client.registration.github.scope=${GITHUB_OAUTH_SCOPES:repo,delete_repo,user,user:email}

# IMPORTANT: Spring Security OAuth2 uses this pattern by default
spring.security.oauth2.client.registration.github.redirect-uri=https://repoai-backend-341232845469.us-central1.run.app/login/oauth2/code/github

# Frontend base URL for post-login redirect
app.frontend.url=${APP_FRONTEND_URL:https://repoai-frontend-516479753863.us-central1.run.app}

# Ensure session cookie works in cross-site requests (frontend on different domain)
server.servlet.session.cookie.same-site=None
server.servlet.session.cookie.secure=true
server.servlet.session.timeout=2d
server.servlet.session.cookie.max-age=2d
# Respect X-Forwarded-* headers on Cloud Run for redirect/security decisions
server.forward-headers-strategy=framework
```

**THE KEY CHANGE:** 

Spring Security OAuth2 uses `/login/oauth2/code/{registrationId}` as the default redirect pattern.

So your **GitHub OAuth callback URL** should be:
```
https://repoai-backend-341232845469.us-central1.run.app/login/oauth2/code/github